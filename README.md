# Improving ligand pose prediction accuracy in noncognate receptors by combining physics-based and data-driven approaches

The MDL method is an approach to reliably predicting ligand binding poses in noncognate receptor structures using short molecular dynamics simulations (MD-based method) and geometric deep learning models (DL-based method). This site provides the data sets and source code for our study entitled "Improving ligand pose prediction accuracy in noncognate receptors by combining physics-based and data-driven approaches".

## Test Datasets and Results

Test sets are available [here](https://figshare.com/s/a8debd7e4766837a1656).

```
LigPoseData
├── DL : Directory for DL-based method
│   ├── "target_slim_em_poses.tar.gz" 
│   │    : Energy-minimized target_slim_poses for DL-based method. 
│   │      (the number of per-receptor poses is five)
│   │   
│   ├── "target_slim_em_poses_n50.tar.gz" 
│   │    : Energy-minimized target_slim_poses for DL-based method. 
│   │      (the number of per-receptor poses is 50)
│   │   
│   ├── "target_slim_poses_inference.csv" : Raw results from the DL-based method.
│   │      (the number of per-receptor poses is five)
│   │ 
│   └── "target_slim_poses_n50_inference.csv" : Raw results from the DL-based method.
│          (the number of per-receptor poses is 50)
│
├── MD : Directory for MD-based method
│   ├── "target_ensemble_structures.tar.gz"
│   │    : An ensemble of receptor structures for each benchmark target 
|   |      (apo crystal structure + MD snapshots)
│   │
│   ├── "target_pdb_structures.tar.gz"
│   │    : The PDB structures of benchmark apo structures and cognate ligands in the holo structures. 
│   │      Each cognate ligand was aligned using the traslation and roatiion matrix used upon the structure 
│   │      alignment between the apo and holo structure.
│   │
│   ├── "target_slim_poses.tar.gz"
│   │    : Docking poses generated by SLIM.
│   │      (the number of per-receptor poses is five)
│   │
│   ├── "target_slim_poses_n50.tar.gz"
│   │    : Docking poses generated by SLIM. 
│   │      (the number of per-receptor poses is 50)
│   │
│   └── "target_raw_data_md.csv"
│        : Raw results from the MD-based method.
│        
├── "target_slim_poses_rmsd.csv" 
│        : RMSD of docking poses with respect to the cognate ligands.
│          (the number of per-receptor poses is five)
│
├── "target_slim_poses_n50_rmsd.csv" 
│        : RMSD of docking poses with respect to the cognate ligands. 
│          (the number of per-receptor poses is 50)
│
└── "target_list.csv" : 30 targets list in csv format.
```


<br>

## Ligand Pose Prediction Using our DL-based Method

### 1. Install conda environment
```bash
conda env create -f requirements.yaml
# without openeye-toolkits
conda env create -f requirements_wo_openeye.yaml
```

### 2. Extract pretrained model checkpoints
Extract checkpoint files.
```bash
tar -xvf checkpoints/ensemble3.tar.gz -C checkpoints
```

if openeye-toolkit is not installed, follow the comment [below](#openeye-license)

### 3. Execute with example file.
Example files consist of a single pdb file, and a single sdf file with multiple poses.
Extract them by following the command below.
```bash
tar -xvf examples/4kkgA-pose5.tar.gz -C examples/
```

At the project root execute the following command
```bash
python pose_prediction.py --pdb_file examples/4kkgA-pose5/4kkgA_snapshot_1010.pdb --sdf_file examples/4kkgA-pose5/4kkgA_snapshot_1010.sdf --output_prefix examples/4kkgA-pose5/4kkgA_snapshot_1010_score
```

You can set number of processes for fast data preparation
```bash
python pose_prediction.py --pdb_file examples/4kkgA-pose5/4kkgA_snapshot_1010.pdb --sdf_file examples/4kkgA-pose5/4kkgA_snapshot_1010.sdf --output_prefix examples/4kkgA-pose5/4kkgA_snapshot_1010_score --num_processes 8
```

For GPU inference set --use_gpu


Output file looks like the below. 

"complex" column indicates the target receptor and ligand file names without extension. if both file names are different, two file names are concatenated with the '+' charactor. 
The results are sorted based on the complex title.

score_1,score_2 and score_3 are scores from indivisual model and score column shows rounded average-score (ensemble-score).
```
complex,score_1,score_2,score_3,score
4kkgA_snapshot_1010_1,0.018,0.006,0.001,0.009
4kkgA_snapshot_1010_2,0.383,0.938,0.464,0.595
4kkgA_snapshot_1010_3,0.996,0.965,0.929,0.963
4kkgA_snapshot_1010_4,0.049,0.033,0.441,0.174
4kkgA_snapshot_1010_5,0.373,0.573,0.464,0.470

...

```

<br><br>

## OpenEye License

An openeye license is required to use the code. If you don't have a license, please obtain the license and then set the OE_LICENSE environment variable before using it.
```bash
export OE_LICENSE=<license_file_path>
```
The chemical feature extraction step requires openeye license. If you do not have the license and want to run the example code, you can skip the step by extracting 4kkgA-pose5-prep.tar.gz file and setting --prep_odir to the directory where txt file exists. 
```bash
tar -xvf examples/4kkgA-pose5-prep.tar.gz -C examples
python pose_prediction.py --pdb_file examples/4kkgA-pose5/4kkgA_snapshot_1010.pdb --sdf_file examples/4kkgA-pose5/4kkgA_snapshot_1010.sdf --output_prefix examples/4kkgA-pose5/4kkgA_snapshot_1010_score --prep_odir examples/4kkgA-pose5-prep
```

If you do not set up the argument, a temporary directory will be used by default.
### 
